machine:
  services:
    - docker

dependencies:
  override:
    - docker build -t test-integration-nodejs:latest .
    - docker run -e "APIKEY=${APIKEY}" --name=test-integration-nodejs-init test-integration-nodejs:latest /initialize.sh
    - docker commit test-integration-nodejs-init test-integration-nodejs:latest

test:
  override:
    - docker run --name=test-integration-nodejs-helloworld test-integration-nodejs:latest /run_hello_world_test.sh
    - docker run --name=test-integration-nodejs-aptfile test-integration-nodejs:latest /run_aptfile_test.sh
  post:
    - docker run --name=DUMP-test-integration-nodejs test-integration-nodejs:latest vagrant ssh -- sudo journalctl
    - docker run --name=DESTROY-test-integration-nodejs test-integration-nodejs:latest vagrant destroy -f
    # TODO: Collect container as an asset?

